@using Digital_Library.Core.ViewModels.Requests
@model BookRequest
@{
 ViewData["Title"] = "Edit Book";
}

<div class="container my-5">
 <div class="card shadow-lg border-0 rounded-4">
  <div class="card-header bg-warning text-dark rounded-top-4">
   <h3 class="mb-0">✏️ Edit Book</h3>
  </div>
  <div class="card-body p-4">
   <form asp-action="EditBook" enctype="multipart/form-data" method="post" class="needs-validation" novalidate>
    <div class="row g-4">

     <!-- Hidden Id -->
     <input type="hidden" asp-for="CategoryID" />

     <!-- Title -->
     <div class="col-md-6">
      <label asp-for="Title" class="form-label fw-bold"></label>
      <input asp-for="Title" class="form-control" placeholder="Enter book title" />
      <span asp-validation-for="Title" class="text-danger"></span>
     </div>

     <!-- Author -->
     <div class="col-md-6">
      <label asp-for="Author" class="form-label fw-bold"></label>
      <input asp-for="Author" class="form-control" placeholder="Enter author name" />
      <span asp-validation-for="Author" class="text-danger"></span>
     </div>

     <!-- Category -->
     <div class="col-md-6">
      <label asp-for="CategoryID" class="form-label fw-bold">Category</label>
      <select asp-for="CategoryID" asp-items="ViewBag.Categories" class="form-select">
       <option value="">-- Select Category --</option>
      </select>
      <span asp-validation-for="CategoryID" class="text-danger"></span>
     </div>

     <!-- Stock -->
     <div class="col-md-6">
      <label asp-for="Stock" class="form-label fw-bold"></label>
      <input asp-for="Stock" class="form-control" type="number" min="0" />
      <span asp-validation-for="Stock" class="text-danger"></span>
     </div>

     <!-- Price Physical -->
     <div class="col-md-6">
      <label asp-for="PricePhysical" class="form-label fw-bold">Physical Price ($)</label>
      <input asp-for="PricePhysical" class="form-control" type="number" step="0.01" min="0" />
      <span asp-validation-for="PricePhysical" class="text-danger"></span>
     </div>

     <!-- Has PDF -->
     <div class="col-md-6 d-flex align-items-center">
      <div class="form-check">
       <input asp-for="HasPDF" class="form-check-input" type="checkbox" id="hasPdfCheck" />
       <label class="form-check-label fw-bold" for="hasPdfCheck">
        Has PDF Version
       </label>
      </div>
     </div>

     <!-- PDF Section -->
     <div id="pdfSection" class="row g-4 @(Model.HasPDF ? "" : "d-none")">
      <!-- PDF File -->
      <div class="col-md-6">
       <label asp-for="PDFFile" class="form-label fw-bold">Upload New PDF (Optional)</label>
       <input asp-for="PDFFile" class="form-control" type="file" accept=".pdf" />
       <span asp-validation-for="PDFFile" class="text-danger"></span>
      </div>

      <!-- Price PDF -->
      <div class="col-md-6">
       <label asp-for="PricePDF" class="form-label fw-bold">PDF Price ($)</label>
       <input asp-for="PricePDF" class="form-control" type="number" step="0.01" min="0" />
       <span asp-validation-for="PricePDF" class="text-danger"></span>
      </div>

      <!-- Borrowable -->
      <div class="col-md-6 d-flex align-items-center">
       <div class="form-check">
        <input asp-for="IsBorrowable" class="form-check-input" type="checkbox" id="borrowCheck" />
        <label class="form-check-label fw-bold" for="borrowCheck">
         Borrowable (Per Day)
        </label>
       </div>
      </div>

      <!-- Price PDF Per Day -->
      <div id="pdfBorrowPriceSection" class="col-md-6 @(Model.IsBorrowable ? "" : "d-none")">
       <label asp-for="PricePDFPerDay" class="form-label fw-bold">PDF Daily Price ($)</label>
       <input asp-for="PricePDFPerDay" class="form-control" type="number" step="0.01" min="0" />
       <span asp-validation-for="PricePDFPerDay" class="text-danger"></span>
      </div>
     </div>

     <!-- Description -->
     <div class="col-12">
      <label asp-for="Description" class="form-label fw-bold"></label>
      <textarea asp-for="Description" class="form-control" rows="4" placeholder="Enter book description"></textarea>
      <span asp-validation-for="Description" class="text-danger"></span>
     </div>

     <!-- Cover -->
     <div class="col-12">
      <label asp-for="ImageBookCover" class="form-label fw-bold">Book Cover</label>
      <input asp-for="ImageBookCover" class="form-control" type="file" accept="image/*" />
      <span asp-validation-for="ImageBookCover" class="text-danger"></span>

      @* Preview Old Cover *@
      @if (ViewBag.CurrentCover != null)
      {
       <div class="mt-3">
        <p class="fw-bold">Current Cover:</p>
        <img src="@ViewBag.CurrentCover" alt="Book Cover" class="img-thumbnail" style="max-height:200px;" />
       </div>
      }
     </div>
    </div>

    <!-- Buttons -->
    <div class="mt-4 d-flex justify-content-end">
     <a asp-action="Index" class="btn btn-outline-secondary me-2">Cancel</a>
     <button type="submit" class="btn btn-warning">Update Book</button>
    </div>
   </form>
  </div>
 </div>
</div>

@section Scripts {
 <partial name="_ValidationScriptsPartial" />
 <script>
  const hasPdfCheck = document.getElementById("hasPdfCheck");
  const borrowCheck = document.getElementById("borrowCheck");
  const pdfSection = document.getElementById("pdfSection");
  const pdfBorrowPriceSection = document.getElementById("pdfBorrowPriceSection");

  function togglePdfSection() {
      if (hasPdfCheck.checked) {
          pdfSection.classList.remove("d-none");
      } else {
          pdfSection.classList.add("d-none");
          borrowCheck.checked = false;
          pdfBorrowPriceSection.classList.add("d-none");
      }
  }

  function toggleBorrowSection() {
      if (borrowCheck.checked) {
          pdfBorrowPriceSection.classList.remove("d-none");
      } else {
          pdfBorrowPriceSection.classList.add("d-none");
      }
  }

  hasPdfCheck.addEventListener("change", togglePdfSection);
  borrowCheck.addEventListener("change", toggleBorrowSection);
 </script>
}
